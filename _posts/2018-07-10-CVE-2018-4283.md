---
layout: post
title:  "CVE-2018-4283: IOGraphics, OOB Read"
date:   2018-07-10 21:31:00 +0800
categories: vulnerabilities
tags: CVE
---

# Description
There is an OOB read vulnerability exists in IOGraphics due to wrong create/release logic.


# Environment
* OS: 		macOS 10.13.5  
* Module:	    IOGraphics.kext

# Analysis
In IDState class, the CreateID method can create IDs in different ways according to parameter ‘options’:  
![createid]("/_asserts/createid.png")  
It can either call reserveRequested or allocID. The 2 methods store id into different queues, the fSpecifiedIDsData and fRetainIDsData.
But when release the previous created id, the logic about choosing queue doesn’t match the one in CreateID. The logic exists in method locateID:  
![createid]("/_asserts/locateid.png")  
It chooses queue according to the id value , not the options any more. So we can go to the wrong queue with a very big id value, e.g. -2. Finally the function getID uses the very big id value as its index:  
![createid]("/_asserts/getid.png")   
Here we get out of boundary read in function getBytesNoCopy. This may lead to LPE, memory corruption …




